var Mist,slice=[].slice;Mist=function(){function t(t){return this.options=null!=t?t:{},this.constructor._self?this.constructor._self:(this.LOGS_ENABLED=this.options.logs_enabled||!1,this.LOG_LEVEL=this.options.log_level||"SILENT",this.on("mist:_socket.onopen",function(t){return function(){var n,e,r;return r=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(r,e,n)}}(this)),this.on("mist:_socket.reconnect",function(t){return function(){var n,e,r;return r=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(r,e,n)}}(this)),this.on("mist:_socket.onmessage",function(t){return function(){var n,e,r;return r=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.info(r,e,n)}}(this)),this.on("mist:_socket.onerror",function(t){return function(){var n,e,r;return r=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.error(r,e,n)}}(this)),this.on("mist:_socket.onclose",function(t){return function(){var n,e,r;return r=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(r,e,n)}}(this)),this.on("mist:command.ping",function(t){return function(){var n,e,r;return r=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(r,e,n)}}(this)),this.on("mist:command.subscribe",function(t){return function(){var n,e,r;return r=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(r,e,n)}}(this)),this.on("mist:command.unsubscribe",function(t){return function(){var n,e,r;return r=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(r,e,n)}}(this)),this.on("mist:command.subscriptions",function(t){return function(){var t,n,e;return e=arguments[0],n=arguments[1],t=3<=arguments.length?slice.call(arguments,2):[],console.log("%cMist.log ::",e,n)}}(this)),this.on("mist:data",function(t){return function(){var n,e,r;return r=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(r,e,n)}}(this)),this.on("mist:data.error",function(t){return function(){var n,e,r;return r=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.error(r,e,n)}}(this)),this.on("mist:metadata.action:create",function(t){return function(){var n,e,r;return r=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(r,e,n)}}(this)),this.on("mist:metadata.action:update",function(t){return function(){var n,e,r;return r=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(r,e,n)}}(this)),this.on("mist:metadata.action:destroy",function(t){return function(){var n,e,r;return r=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(r,e,n)}}(this)),void(this.constructor._self=this))}var n,e,r;return n=[],r=["DEBUG","INFO","WARN","ALERT","ERROR","SILENT"],t.prototype.debug=function(){var t,n,e;return e=arguments[0],n=arguments[1],t=3<=arguments.length?slice.call(arguments,2):[],this.log({level:"DEBUG",styles:"color:#48B5DA",key:e,data:n,args:t})},t.prototype.info=function(){var t,n,e;return e=arguments[0],n=arguments[1],t=3<=arguments.length?slice.call(arguments,2):[],this.log({level:"INFO",styles:"color:#87C45A",key:e,data:n,args:t})},t.prototype.warn=function(){var t,n,e;return e=arguments[0],n=arguments[1],t=3<=arguments.length?slice.call(arguments,2):[],this.log({level:"WARN",styles:"color:#FCF1AB",key:e,data:n,args:t})},t.prototype.alert=function(){var t,n,e;return e=arguments[0],n=arguments[1],t=3<=arguments.length?slice.call(arguments,2):[],this.log({level:"ALERT",styles:"color:#FEA06B",key:e,data:n,args:t})},t.prototype.error=function(){var t,n,e;return e=arguments[0],n=arguments[1],t=3<=arguments.length?slice.call(arguments,2):[],this.log({level:"ERROR",styles:"color:#F22C68",key:e,data:n,args:t})},t.prototype.has_permission=function(t){return r.indexOf(this.LOG_LEVEL)<=r.indexOf(t)},t.prototype.log=function(t){var e;return e={level:t.level,styles:t.styles,key:t.key,data:t.data,args:t.args,timestamp:new Date},this.LOGS_ENABLED&&this.has_permission(e.level)&&console.log("%cMist.log:"+e.level+" ::",e.styles,e.key,e.data),n.push(e)},t.prototype.backlog=function(){var t,e,r,s;for(s=[],t=0,e=n.length;e>t;t++)r=n[t],s.push(console.log("%c("+r.timestamp+") Mist.backlog:"+r.level+" ::",r.styles,r.key+" - ",r.data));return s},t.prototype.enable_logs=function(){return this.warn("Mist logs enabled"),this.LOGS_ENABLED=!0},t.prototype.disable_logs=function(){return this.warn("Mist logs disabled"),this.LOGS_ENABLED=!1},t._self=null,e={},t.prototype._has_event=function(t){return null!=e[t]},t.prototype._has_handler=function(t,n){return-1!==e[t].indexOf(n)},t.prototype._add_handler=function(t,n){return e[t]||(e[t]=[]),this._has_handler(t,n)?void 0:e[t].push(n)},t.prototype._remove_handler=function(t,n){return this._has_event(t)&&this._has_handler(t,n)?e[t].splice(e[t].indexOf(n),1):void 0},t.prototype.on=function(t,n){return t&&n?(this._add_handler(t,n),n):void 0},t.prototype.once=function(t,n){var e;return e=function(r){return function(){return null!=n&&n.apply(r,arguments),r.off(t,e)}}(this),this.on(t,e)},t.prototype.off=function(t,n){return t&&n?this._remove_handler(t,n):t?delete e[t]:e={}},t.prototype.fire=function(){var t,n,r,s,o,i,c;if(o=arguments[0],n=arguments[1],t=3<=arguments.length?slice.call(arguments,2):[],e[o]){for(c=e[o],s=0,i=c.length;i>s;s++)r=c[s],null!=r&&r.apply(this,[o,n,t]);return!0}},t.prototype.events=function(t){return t?this._has_event(t)?e[t]:this.log("Unknown event - ",t):this.log("Registered Events - ",e)},t.prototype.connect=function(t,n){var e,r,s,o;return null==n&&(n=!1),this._socket_url=t,this._socket=new WebSocket(t),null!=(e=this._socket)&&(e.onopen=function(t){return function(e){return t.fire("mist:_socket.onopen",e),n?t.fire("mist:_socket.reconnect",e):void 0}}(this)),null!=(r=this._socket)&&(r.onerror=function(t){return function(n){return t.fire("mist:_socket.onerror",n)}}(this)),null!=(s=this._socket)&&(s.onclose=function(t){return function(n){return t.fire("mist:_socket.onclose",n)}}(this)),null!=(o=this._socket)&&(o.onmessage=function(t){return function(n){var e,r,s,o,i;if(t.fire.apply(t,["mist:_socket.onmessage"].concat(slice.call(arguments))),s=JSON.parse(n.data),t.fire("mist:data",s),(o=null!=s?s.error:void 0)&&t.fire("mist:data.error",s.error),r=null!=s?s.command:void 0)switch(r){case"ping":t.fire("mist:command.ping",s);break;case"subscribe":t.fire("mist:command.subscribe",s);break;case"unsubscribe":t.fire("mist:command.unsubscribe",s);break;case"list":t.fire("mist:command.subscriptions",s.subscriptions)}if((i=JSON.parse((null!=s?s.data:void 0)||!1))&&(e=i.action))switch(e){case"create":return t.fire("mist:metadata.action:create",s);case"update":return t.fire("mist:metadata.action:update",s);case"destroy":return t.fire("mist:metadata.action:destroy",s)}}}(this)),this._socket},t.prototype.reconnect=function(){return this.disconnect(),this.connect(this._socket_url,!0)},t.prototype.disconnect=function(){var t;return null!=(t=this._socket)?t.close():void 0},t.prototype.subscribe=function(t){var n;return null==t&&(t=[]),this.is_connected()?null!=(n=this._socket)&&n.send(JSON.stringify({command:"subscribe",tags:t})):this.once("mist:_socket.onopen",function(n){return function(e){return n.subscribe(t)}}(this)),t},t.prototype.unsubscribe=function(t){var n;null==t&&(t=[]),this.is_connected()?null!=(n=this._socket)&&n.send(JSON.stringify({command:"unsubscribe",tags:t})):this.once("mist:_socket.onopen",function(n){return function(e){return n.unsubscribe(t)}}(this))},t.prototype.subscriptions=function(){var t;this.is_connected()?null!=(t=this._socket)&&t.send(JSON.stringify({command:"list"})):this.once("mist:_socket.onopen",function(t){return function(n){return t.subscriptions()}}(this))},t.prototype.state=function(){var t,n;switch(null!=(t=this._socket)?t.readyState:void 0){case 0:return"not connected";case 1:return"open";case 2:return"closing";case 3:return"closed";default:return"unknown state - "+(null!=(n=this._socket)?n.readyState:void 0)}},t.prototype.is_connected=function(){return"open"===this.state()},t.prototype.ping=function(){var t;return null!=(t=this._socket)?t.send(JSON.stringify({command:"ping"})):void 0},t}();