var Mist,slice=[].slice;Mist=function(){function t(t){return this.options=null!=t?t:{},this.constructor._self?this.constructor._self:"undefined"==typeof Eventify||"undefined"==typeof Logify?void console.warn("You are missing the following dependencies: \n	"+("undefined"==typeof Eventify?"Eventify (https://github.com/sdomino/eventify)":"")+" \n	"+("undefined"==typeof Logify?"Logify (https://github.com/sdomino/logify)":"")+" \n\nMist will be unable to function properly until all dependencies are satisfied."):(Eventify.assign(this),Logify.assign(this),this.logName="[Mist]",this.logLevel=this.options.logLevel||"DEBUG",this.logsEnabled=this.options.logsEnabled||!1,this.on("mist:_socket.onopen",function(t){return function(){var n,e,i;return i=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(i,e,n)}}(this)),this.on("mist:_socket.reconnect",function(t){return function(){var n,e,i;return i=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(i,e,n)}}(this)),this.on("mist:_socket.onmessage",function(t){return function(){var n,e,i;return i=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.info(i,e,n)}}(this)),this.on("mist:_socket.onerror",function(t){return function(){var n,e,i;return i=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.error(i,e,n)}}(this)),this.on("mist:_socket.onclose",function(t){return function(){var n,e,i;return i=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(i,e,n)}}(this)),this.on("mist:command.ping",function(t){return function(){var n,e,i;return i=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(i,e,n)}}(this)),this.on("mist:command.subscribe",function(t){return function(){var n,e,i;return i=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(i,e,n)}}(this)),this.on("mist:command.unsubscribe",function(t){return function(){var n,e,i;return i=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(i,e,n)}}(this)),this.on("mist:command.subscriptions",function(t){return function(){var t,n,e;return e=arguments[0],n=arguments[1],t=3<=arguments.length?slice.call(arguments,2):[],console.log("%cMist.log ::",e,n)}}(this)),this.on("mist:data",function(t){return function(){var n,e,i;return i=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(i,e,n)}}(this)),this.on("mist:data.error",function(t){return function(){var n,e,i;return i=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.error(i,e,n)}}(this)),this.on("mist:metadata.action:create",function(t){return function(){var n,e,i;return i=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(i,e,n)}}(this)),this.on("mist:metadata.action:update",function(t){return function(){var n,e,i;return i=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(i,e,n)}}(this)),this.on("mist:metadata.action:destroy",function(t){return function(){var n,e,i;return i=arguments[0],e=arguments[1],n=3<=arguments.length?slice.call(arguments,2):[],t.debug(i,e,n)}}(this)),void(this.constructor._self=this))}return t._self=null,t.prototype.connect=function(t,n){var e,i,s,o;return null==n&&(n=!1),this._socket_url=t,this._socket=new WebSocket(t),null!=(e=this._socket)&&(e.onopen=function(t){return function(e){return t.fire("mist:_socket.onopen",e),n?t.fire("mist:_socket.reconnect",e):void 0}}(this)),null!=(i=this._socket)&&(i.onerror=function(t){return function(n){return t.fire("mist:_socket.onerror",n)}}(this)),null!=(s=this._socket)&&(s.onclose=function(t){return function(n){return t.fire("mist:_socket.onclose",n)}}(this)),null!=(o=this._socket)&&(o.onmessage=function(t){return function(n){var e,i,s,o,r;if(t.fire.apply(t,["mist:_socket.onmessage"].concat(slice.call(arguments))),s=JSON.parse(n.data),t.fire("mist:data",s),(o=null!=s?s.error:void 0)&&t.fire("mist:data.error",s.error),i=null!=s?s.command:void 0)switch(i){case"ping":t.fire("mist:command.ping",s);break;case"subscribe":t.fire("mist:command.subscribe",s);break;case"unsubscribe":t.fire("mist:command.unsubscribe",s);break;case"list":t.fire("mist:command.subscriptions",s.subscriptions)}if((r=JSON.parse((null!=s?s.data:void 0)||!1))&&(e=r.action))switch(e){case"create":return t.fire("mist:metadata.action:create",s);case"update":return t.fire("mist:metadata.action:update",s);case"destroy":return t.fire("mist:metadata.action:destroy",s)}}}(this)),this._socket},t.prototype.reconnect=function(){return this.disconnect(),this.connect(this._socket_url,!0)},t.prototype.disconnect=function(){var t;return null!=(t=this._socket)?t.close():void 0},t.prototype.subscribe=function(t){var n;return null==t&&(t=[]),this.is_connected()?null!=(n=this._socket)&&n.send(JSON.stringify({command:"subscribe",tags:t})):this.once("mist:_socket.onopen",function(n){return function(e){return n.subscribe(t)}}(this)),t},t.prototype.unsubscribe=function(t){var n;null==t&&(t=[]),this.is_connected()?null!=(n=this._socket)&&n.send(JSON.stringify({command:"unsubscribe",tags:t})):this.once("mist:_socket.onopen",function(n){return function(e){return n.unsubscribe(t)}}(this))},t.prototype.subscriptions=function(){var t;this.is_connected()?null!=(t=this._socket)&&t.send(JSON.stringify({command:"list"})):this.once("mist:_socket.onopen",function(t){return function(n){return t.subscriptions()}}(this))},t.prototype.state=function(){var t,n;switch(null!=(t=this._socket)?t.readyState:void 0){case 0:return"not connected";case 1:return"open";case 2:return"closing";case 3:return"closed";default:return"unknown state - "+(null!=(n=this._socket)?n.readyState:void 0)}},t.prototype.is_connected=function(){return"open"===this.state()},t.prototype.ping=function(){var t;return null!=(t=this._socket)?t.send(JSON.stringify({command:"ping"})):void 0},t}();